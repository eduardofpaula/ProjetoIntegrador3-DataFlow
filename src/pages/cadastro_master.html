<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="../assets/style/cadastro.css" />
    <title>Cadastro de Usuário</title>
</head>

<body>
    <div id="app">
        <header>
            <img src="../assets/images/logo-dom-rock.png" alt="logo-dom-rock" id="logo">
            <nav>
                <a href="/public/index.html">Home</a>
                <a href="../pages/upload-csv.html">Importar novo Arquivo</a>
                <a href="#">
                    <img src="../assets/images/foto-perfil-branco.png" alt="foto-perfil-branco" id="fotoPerfilIcon">
                </a>
            </nav>
        </header>
        <main>
            <h1 id="h1Cadastrar">Cadastrar usuário</h1>
            <div id="instrucoes">
                <p>Para cadastrar um usuário é necessário preencher corretamente os campos abaixo com os respectivos
                    dados.
                </p><br>
                <p>Os campos com <font color="red">*</font> são de preenchimento obrigatório.</p>
            </div>
            <div class="dados-cadastro">

                <div class="campoTexto">
                    <label>Email do usuário <font color="red">*</font></label>
                    <input type="email" id="email" v-model="emailUser" required />
                </div>
                <div>
                    <label class="campoNivel">Nível de acesso do usuário <font color="red">*</font>
                    </label>
                </div>
                <div class="campoCheckbox">
                    <div class="zone">
                        <input type="checkbox" id="landing" value="LZ" v-model="nivelAcesso" />
                        <label class="checkNivel">Landing</label>
                    </div>
                    <div class="zone">
                        <input type="checkbox" id="bronze" value="B" v-model="nivelAcesso" />
                        <label class="checkNivel">Bronze</label>
                    </div>
                    <div class="zone">
                        <input type="checkbox" id="silver" value="S" v-model="nivelAcesso" />
                        <label class="checkNivel">Silver</label>
                    </div>
                    <div class="zone">
                        <input type="checkbox" id="full" value="Full" v-model="nivelAcesso"
                            @change="desmarcarOutrasOpcoes" />
                        <label class="checkNivel">Full</label>
                    </div>
                </div>
                <div class="campoTexto">
                    <label>CNPJ da organização <font color="red">*</font></label>
                    <input type="text" id="cnpj" v-model="cnpjOrg">
                    <p v-if="!cnpjValido && cnpjOrg !== ''">CNPJ inválido</p>
                </div>
                <div class="campoTexto">
                    <label>Razão social <font color="red">*</font></label>
                    <input type="text" id="nome" v-model="razaoSocial" />
                </div>
                <div id="buttons">
                    <a href="../../public/index.html">
                        <button id="btnCancelar">Cancelar</button>
                    </a>
                    <button id="btnCadastrar" @click="adicionarDados()">Cadastrar</button>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Objeto para guardar infos
        const app = new Vue({
            el: "#app",
            data: {
                emailUser: null,
                nivelAcesso: [],
                cnpjOrg: null,
                razaoSocial: null,
                cnpjValido: true
            },
            methods: {
                adicionarDados() {
                    // Criar um objeto para armazenar os dados do usuário
                    let novoUsuario = {
                        emailUsuario: this.emailUser,
                        nivelAcesso: this.nivelAcesso,
                        cnpj: this.cnpjOrg,
                        organizacao: this.razaoSocial
                    };

                    // Aqui você pode fazer o que quiser com os dados, como enviar para um servidor, exibir em algum lugar, etc.
                    console.log("Novo usuário:", novoUsuario);

                    //Enviar dados para o backend
                    fetch("http://localhost:8080/register/cadastro", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify(novoUsuario),
                    })
                        .then((response) => {
                            return response.json();
                        })
                        .then((responseJson) => {
                            if (
                                responseJson.critica !== "Processamento efetuado com sucesso"
                            ) {
                                Swal.fire({
                                    title: "Erro",
                                    text: responseJson.critica,
                                    icon: "error", // Ícone personalizado (success, error, warning, info)
                                    confirmButtonText: "OK", // Texto do botão de confirmação
                                });
                                return;
                            } else {
                                Swal.fire({
                                    title: "Sucesso",
                                    text: responseJson.critica,
                                    icon: "success", // Ícone personalizado (success, error, warning, info)
                                    confirmButtonText: "OK", // Texto do botão de confirmação
                                }).then((result) => {
                                    // Limpar os campos após o cadastro
                                    this.emailUser = null;
                                    this.nivelAcesso = [];
                                    this.cnpjOrg = null;
                                    this.razaoSocial = null;
                                    //voltar pada index
                                    window.location.href = "/src/pages/navegation.html";
                                });
                            }
                            // Lidar com a resposta do backend aqui se necessário
                        });
                },
                desmarcarOutrasOpcoes() {
                    if (this.nivelAcesso.includes("Full")) {
                        this.nivelAcesso = ["Full"];
                    }
                }
            }
        });
    </script>
</body>

</html>